@startuml
' =====================================
'title Diagrama de Seqüència – Usuari reproduint vídeo
' Sense servidor de vídeos separat (Express gestiona tot)
' =====================================

actor Usuari
participant "App mòbil" as App
participant "Spring Boot API" as Spring
participant "Odoo" as Odoo
participant "ExpressJS" as Express
participant "MySQL\nCatàleg" as MySQL
participant "MongoDB\nMetadades" as Mongo

' =============================
' Inici de sessió
' =============================
Usuari -> App : Obre aplicació
App -> Odoo : Login (credencials)
Odoo -> Odoo : Valida usuari i subscripció
Odoo --> App : JWT

' =============================
' Consulta de catàleg
' =============================
Usuari -> App : Consulta catàleg
App -> Spring : Request catàleg (JWT)
Spring -> Odoo : Valida JWT
Odoo --> Spring : Tot be
Spring -> MySQL : Consulta catàleg base
MySQL --> Spring : Dades catàleg
Spring -> Mongo : Consulta metadades extres
Mongo --> Spring : Metadades
Spring --> App : Catàleg agregat

loop Per cada vídeo del catàleg
  App -> Express : Demana thumbnail
  Express -> Express : Obté thumbnail
  Express --> App : Thumbnail
end

' =============================
' Selecció de contingut
' =============================
Usuari -> App : Selecciona vídeo
App -> Express : Sol·licita reproducció (JWT)
Express -> Odoo : Comprova permisos i subscripció
Odoo --> Express : Tot be

Express -> Express : Prepara stream HLS

' =============================
' Reproducció i seguiment
' =============================
Express --> App : Stream de vídeo

loop Cada X segons
  App -> Spring : Envia progrés reproducció
  Spring -> Mongo : Registra visualització
end

App -> Spring : Final de reproducció
Spring -> Mongo : Marca vídeo com vist
@enduml