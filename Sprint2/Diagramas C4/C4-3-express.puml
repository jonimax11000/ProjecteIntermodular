@startuml C4_Component
!include https://raw.githubusercontent.com/plantuml-stdlib/C4-PlantUML/master/C4_Component.puml

title Component Diagram for Backend Server - Video Processing

Container_Boundary(backend, "Backend Server") {
    
    Component(controllers, "VideoController", "Controller", "Handles HTTP requests for video operations")
    
    folder "Domain Layer" {
        Component(get_videos_uc, "GetVideosUseCase", "UseCase", "Retrieves list of available videos")
        Component(get_user_id_uc, "GetUserByIdUseCase", "UseCase", "Logic to retrieve user by ID")
        Component(get_user_thumb_uc, "GetUserByThmbnailUseCase", "UseCase", "Logic to retrieve user by thumbnail")
        Component(process_video_uc, "ProcessVideoUseCase", "UseCase", "Processes video for HLSL with ffmpeg")
        
        Component(repo_interface, "IVideoRepository", "Interface", "Abstracts data access")
    }

    folder "Infrastructure Layer" {
        Component(repo_impl, "VideoRepositoryIntern", "Repository Implementation", "Implements data access using file system helper")
        Component(ffmpeg_service, "FFmpegService", "Service", "Handles video processing operations")
    }

    folder "Data Layer" {
        Component(data_helper, "videos.ts", "Data Helper", "Scans directories and extracts metadata using ffmpeg")
    }
}

System_Ext(filesystem, "File System", "Stores MP4 files, thumbnails and processed videos")
System_Ext(ffmpeg, "FFmpeg", "External tool for video processing")

Rel(controllers, get_videos_uc, "Uses", "GET /videos")
Rel(controllers, get_user_id_uc, "Uses", "GET /users/:id")
Rel(controllers, get_user_thumb_uc, "Uses", "GET /users/by-thumbnail")
Rel(controllers, process_video_uc, "Uses", "POST /videos/process")

Rel(get_videos_uc, repo_interface, "Uses")
Rel(get_user_id_uc, repo_interface, "Uses")
Rel(get_user_thumb_uc, repo_interface, "Uses")
Rel(process_video_uc, repo_interface, "Uses")
Rel(process_video_uc, ffmpeg_service, "Uses", "processForHLSL()")

Rel(repo_impl, repo_interface, "Implements")
Rel(repo_impl, data_helper, "Calls methods to load videos")

Rel(ffmpeg_service, ffmpeg, "Executes commands", "ffmpeg CLI")
Rel(ffmpeg_service, filesystem, "Reads/Writes files", "fs")

Rel(data_helper, filesystem, "Reads video files", "fs, ffmpeg")
Rel(data_helper, ffmpeg, "Extracts metadata", "ffprobe")

@enduml